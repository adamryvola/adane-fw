<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>api/db/dao/BasicDAO.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="AccountDAO.html">AccountDAO</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#addAndWhere">addAndWhere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#addWhere">addWhere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#createQuery">createQuery</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#getAll">getAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#getByCriteria">getByCriteria</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#getByField">getByField</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#getById">getById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#returnResult">returnResult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountDAO.html#update">update</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="AccountModel.html">AccountModel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountModel.html#$beforeInsert">$beforeInsert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountModel.html#$beforeUpdate">$beforeUpdate</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="BasicDAO.html">BasicDAO</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#addAndWhere">addAndWhere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#addWhere">addWhere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#createQuery">createQuery</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#getAll">getAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#getByCriteria">getByCriteria</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#getByField">getByField</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#getById">getById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#returnResult">returnResult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicDAO.html#update">update</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="BasicModel.html">BasicModel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicModel.html#.makeQuery">makeQuery</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicModel.html#$beforeInsert">$beforeInsert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BasicModel.html#$beforeUpdate">$beforeUpdate</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CRUDEndpoint.html">CRUDEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CRUDEndpoint.html#getRouter">getRouter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CRUDEndpoint.html#initAdditionalEndpoints">initAdditionalEndpoints</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CRUDEndpoint.html#initCreateEndpoint">initCreateEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CRUDEndpoint.html#initDeleteEndpoint">initDeleteEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CRUDEndpoint.html#initEndpoints">initEndpoints</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CRUDEndpoint.html#initGetAllEndpoint">initGetAllEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CRUDEndpoint.html#initGetByIdEndpoint">initGetByIdEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CRUDEndpoint.html#initUpdateEndpoint">initUpdateEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CRUDEndpoint.html#sendErr">sendErr</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="EndpointRouter.html">EndpointRouter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EndpointRouter.html#getRouter">getRouter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EndpointRouter.html#initAdditionalEndpoints">initAdditionalEndpoints</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EndpointRouter.html#initEndpoints">initEndpoints</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EndpointRouter.html#sendErr">sendErr</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-DBFactory-DBFactory.html">DBFactory</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="PermissionDAO.html">PermissionDAO</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#addAndWhere">addAndWhere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#addWhere">addWhere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#createQuery">createQuery</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#getAll">getAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#getByCriteria">getByCriteria</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#getByField">getByField</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#getById">getById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#returnResult">returnResult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionDAO.html#update">update</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="PermissionModel.html">PermissionModel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionModel.html#$beforeInsert">$beforeInsert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PermissionModel.html#$beforeUpdate">$beforeUpdate</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="PublicModel.html">PublicModel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PublicModel.html#$beforeInsert">$beforeInsert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PublicModel.html#$beforeUpdate">$beforeUpdate</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RoleDAO.html">RoleDAO</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#addAndWhere">addAndWhere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#addWhere">addWhere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#createQuery">createQuery</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#getAll">getAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#getByCriteria">getByCriteria</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#getByField">getByField</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#getById">getById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#returnResult">returnResult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleDAO.html#update">update</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RoleModel.html">RoleModel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleModel.html#$beforeInsert">$beforeInsert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RoleModel.html#$beforeUpdate">$beforeUpdate</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="UserDAO.html">UserDAO</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#addAndWhere">addAndWhere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#addWhere">addWhere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#createQuery">createQuery</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#getAll">getAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#getByCriteria">getByCriteria</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#getByField">getByField</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#getById">getById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#returnResult">returnResult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserDAO.html#update">update</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="UserModel.html">UserModel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserModel.html#$beforeInsert">$beforeInsert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserModel.html#$beforeUpdate">$beforeUpdate</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="UserRouter.html">UserRouter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserRouter.html#getRouter">getRouter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserRouter.html#initAdditionalEndpoints">initAdditionalEndpoints</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserRouter.html#initCreateEndpoint">initCreateEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserRouter.html#initDeleteEndpoint">initDeleteEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserRouter.html#initEndpoints">initEndpoints</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserRouter.html#initGetAllEndpoint">initGetAllEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserRouter.html#initGetByIdEndpoint">initGetByIdEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserRouter.html#initUpdateEndpoint">initUpdateEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="UserRouter.html#sendErr">sendErr</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-DBFactory.html">DBFactory</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Errors.html">Errors</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Errors.html#~AbstractClassConstructor">AbstractClassConstructor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Errors.html#~CreateEntityFailed">CreateEntityFailed</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Errors.html#~GetAllFailed">GetAllFailed</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Errors.html#~GetByCriteriaFailed">GetByCriteriaFailed</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Errors.html#~GetByFieldFailed">GetByFieldFailed</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Errors.html#~GetByIdFailed">GetByIdFailed</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Errors.html#~InvalidArguments">InvalidArguments</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Errors.html#~RemoveEntityFailed">RemoveEntityFailed</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Errors.html#~UpdateEntityFailed">UpdateEntityFailed</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Migrations.html">Migrations</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Migrations.html#~initBasicModelTable">initBasicModelTable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Migrations.html#~initPublicModelTable">initPublicModelTable</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Tables.html">Tables</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">api/db/dao/BasicDAO.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const _ = require('lodash');
const { Errors, options } = require('../../../constants');
const debug = require('../../../log')('BasicDAO');

/**
 * BasicDAO implementation with standard CRUD operations and query creator
 * @abstract
 */
class BasicDAO {
    /**
     * Constructor with model (required)
     * @param model {BasicModel} model class
     * @throws {AbstractClassConstructor} Cannot crate Basic class directly - subclass needed
     * @returns {BasicDAO}
     */
    constructor(model) {
        if (new.target === BasicDAO) {
            throw Error(Errors.AbstractClassConstructor('BasicDAO'));
        }
        this.setModel(model);
        return this;
    }

    getModel() {
        return this.model;
    }

    setModel(model) {
        this.model = model;
    }

    /**
     * Get entity by ID
     * @param id {number} entity id
     * @param context {ReqContext} request context
     * @throws {GetByIdFailed}
     * @returns {BasicModel} Promise that returns entity
     */
    getById(id, context) {
        if (!id) {
            throw new Error(Errors.InvalidArguments('BasicDAO.getById', 'id'));
        }
        return this.getModel().makeQuery((trx) => this.createQuery(trx, context).findById(id)
            .catch(err => {
                debug('GgetById error', err.message);
                throw new Error(Errors.GetByIdFailed('BasicDAO.getById'));
            }));
    }

    /**
     * Get entities by field value
     * @param field {Object} Field object
     * @param {string} field.name Database column name
     * @param {string} field.operation Operation for comparing values
     * @param {any} field.value Attribute value
     * @param context {ReqContext} request context
     * @throws {GetByFieldFailed}
     * @returns {BasicModel[]}Promise that returns list of entities
     */
    getByField(field, context) {
        return this.getModel()
            .makeQuery((trx) =>
                this.createQuery(trx, context)
                    .skipUndefined().where(field.name, field.operation, field.value))
            .catch(err => {
                debug('GetByField', err.message);
                throw new Error(Errors.GetByFieldFailed('BasicDAO'));
            });
    }

    /**
     * Get all entities
     * @param context {ReqContext} request context
     * @throws {GetAllFailed}
     * @returns {BasicModel[]} Promise that returns list of entites
     */
    getAll(context) {
        return this.getModel().makeQuery((trx) => this.createQuery(trx, context))
            .catch(err => {
                debug('GetAll', err.message);
                throw new Error(Errors.GetAllFailed('BasicDAO'));
            });
    }

    /**
     * Get entities by criteria array
     * @param filter {Object[]} Filter array
     * @param {string} filter[].name Database column name
     * @param {string} filter[].operation Operation for comparing values
     * @param {any} filter[].value Attribute value
     * @param context {ReqContext} request context
     * @throws {GetByCriteriaFailed}
     * @returns {BasicModel[]}Promise that returns list of entities
     */
    getByCriteria(filter, context) {
        return this.getModel().makeQuery(trx => {
            let query = this.createQuery(trx, context);
            if (_.isEmpty(filter)) return this.getAll(context);
            query = this.addWhere(query, filter[0].column, filter[0].value, filter[0].operation);
            if (filter.length === 1) return this.returnResult(query);
            for (let i = 1; i &lt; filter.length; i += 1) {
                query = this.addAndWhere(query, filter[i].value, filter[i].column, filter[i].operation);
            }
            return this.returnResult(query);
        }).catch(err => {
            debug('GetByCriteria', err.message);
            throw new Error(Errors.GetByCriteriaFailed('BasicDAO'));
        });
    }

    /**
     * Create entity (graph style, with all relations)
     * @param data {BasicModel} data object
     * @param context {ReqContext} request context
     * @throws {CreateEntityFailed | InvalidArguments}
     * @returns {BasicModel} Promise that returns created entity
     */
    create(data, context) {
        const object = data;
        if (!object) {
            throw new Error(Errors.InvalidArguments('BasicDAO.create', 'object'));
        }
        return this.getModel().makeQuery(trx =>
            this.createQuery(trx, context).insertGraph({})
                .then(entity => {
                    object.id = entity.id;
                    return this.createQuery(trx, context).upsertGraph(object, options.UpsertOptions);
                }).catch(err => {
                    debug('Create', err.message);
                    throw new Error(Errors.CreateEntityFailed('BasicDAO'));
                }));
    }

    /**
     * Update entity (graph style, with all relations)
     * @param object {BasicModel} data object
     * @param context {ReqContext} request context
     * @throws {UpdateEntityFailed | InvalidArguments}
     * @returns {BasicModel} Promise that returns updated entity
     */
    update(object, context) {
        if (!object) {
            throw new Error(Errors.InvalidArguments('BasicDAO.update', 'object'));
        }
        return this.getModel().makeQuery(trx =>
            this.createQuery(trx, context).upsertGraph(object, options.UpsertOptions)
                .catch(err => {
                    debug('Update', err.message);
                    throw new Error(Errors.UpdateEntityFailed('BasicDAO'));
                }));
    }

    /**
     * Remove entity by id
     * @param id {number} id of entity to be removed
     * @param context {ReqContext} request context
     * @throws {RemoveEntityFailed | InvalidArguments}
     * @returns {Object} result
     */
    remove(id, context) {
        if (!id) {
            throw new Error(Errors.InvalidArguments('BasicDAO.remove', 'id'));
        }

        return this.getModel().makeQuery(trx =>
            this.createQuery(trx, context).deleteById(id)
                .catch(err => {
                    debug('Remove', err.message);
                    throw new Error(Errors.RemoveEntityFailed(err.message));
                }));
    }

    /**
     * Transactional query creator
     * @param trx {Objection.Transaction} transaction
     * @param context {ReqContext} request context
     * @returns {Objection.QueryBuilder&lt;BasicModel>}
     * Transactional query builder transactional with request context injected
     */
    createQuery(trx, context) {
        return this.getModel().query(trx).eager(this.getModel().relations).context(context);
    }

    /**
     * Add where condition to query
     * @param query {Objection.QueryBuilder&lt;BasicModel>} Query builder
     * @param field {Object} field
     * @param {string} field.name Database column name
     * @param {string} field.operation Operation for comparing values
     * @param {any} field.value Attribute value
     * @returns {Objection.QueryBuilder&lt;BasicModel>}
     */
    addAndWhere(query, { name, value, operation = '=' }) {
        return query.andWhere(name, operation, value);
    }

    /**
     * Add first where condition to query
     * @param query {Objection.QueryBuilder&lt;BasicModel>} Query builder
     * @param field {Object} field
     * @param {string} field.name Database column name
     * @param {string} field.operation Operation for comparing values
     * @param {any} field.value Attribute value
     * @returns {Objection.QueryBuilder&lt;BasicModel>}
     */
    addWhere(query, { name, operation = '=', value }) {
        return query.skipUndefined().where(name, operation, value);
    }

    /**
     * Resolve query builder or log error and pass them to next catcher
     * @param query {Objection.QueryBuilder&lt;BasicModel>} Query builder, that will be resolved
     * @returns {BasicEntity[]} Promise that return list of entities
     */
    returnResult(query) {
        return query.then(result => result)
            .catch((err) => {
                debug('Return result', err.message);
                throw err;
            });
    }
}

module.exports = BasicDAO;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.4</a> on Sun Oct 01 2017 14:09:35 GMT+0200 (Střední Evropa (letní čas)) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
